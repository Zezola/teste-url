<!DOCTYPE html>
<html>
<body>
  <h1>Testando Dashboard App</h1>
  <div id="debug">Aguardando dados do Chatwoot...</div>
  <div id="conversation-infos"></div>
  <div id="contact-infos"></div>

  <script>
    window.addEventListener("message", function(event) {
      // O Chatwoot manda strings JSON, precisa dar parse
      console.log("Pegou o evento do Chatwoot")
      try {
        const eventData = JSON.parse(event.data);
        if (eventData.event === "appContext") {
          const contactInfosDiv = document.getElementById("contact-infos")
          contactInfosDiv.innerHTML = JSON.stringify(eventData.data.contact)

          const conversationInfosDiv = document.getElementById("conversation-infos")
          conversationInfosDiv.innerHTML = JSON.stringify(eventData.data.conversation)

          document.getElementById('debug').innerText = 
            "Usuário conectado: " + eventData.data.contact.email;
          
          console.log("Payload completo:", eventData.data);
        }
      } catch (e) {
        console.error("Não é um JSON válido", event.data);
      }
    });

    // Avisa o Chatwoot que a página está pronta para receber dados
    window.parent.postMessage('chatwoot-dashboard-app:fetch-info', '*');
  </script>
</body>
</html>