<!DOCTYPE html>
<html>
<body>
  <h1>Testando Dashboard App</h1>
  <div id="debug">Aguardando dados do Chatwoot...</div>
  <div id="conversation-infos"></div>
  <div id="contact-infos"></div>

  <script>
    window.addEventListener("message", function(event) {
      console.log("Pegou o evento do Chatwoot")
      try {
        const eventData = JSON.parse(event.data);
        if (eventData.event === "appContext") {
          const ACCOUNT_ID = eventData.data.conversation.account_id
          const INBOX_ID = eventData.data.conversation.inbox_id
          const contactInfosDiv = document.getElementById("contact-infos")
          contactInfosDiv.innerHTML = `Numero de quem estamos conversando = ${eventData.data.contact.phone_number}`

          const conversationInfosDiv = document.getElementById("conversation-infos")
          conversationInfosDiv.innerHTML = `ID da caixa de entrada que essa conversa está = ${eventData.data.conversation.inbox_id}`
          conversationInfosDiv.innerText = `ID da conta em que a conversa está = ${ACCOUNT_ID}`


          document.getElementById('debug').innerText = 
            "Usuário conectado: " + eventData.data.contact.email;
          
          console.log("Payload completo:", eventData.data);
        }
      } catch (e) {
        console.error("Não é um JSON válido", event.data);
      }
    });


    // Avisa o Chatwoot que a página está pronta para receber dados
    window.parent.postMessage('chatwoot-dashboard-app:fetch-info', '*');
  </script>
</body>
</html>